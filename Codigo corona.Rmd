---
title: "Codigo corona"
author: "Everybody"
date: "23/6/2020"
output: html_document



```{r Paquetes}
library(tidyverse)
library(dplyr)
library(plotly)
library(hrbrthemes)
library(htmlwidgets)
library(viridisLite)
library(viridis)
library(ggthemes)
```

####Hasta fallecidos 29/09

```{r Carga Datos, matriz y creación de variables}
Dia <- c(  "30/06/2020", "1/07/2020", "2/07/2020", "3/07/2020",
          "4/07/2020","5/07/2020","6/07/2020","7/07/2020","8/07/2020","9/07/2020", "10/07/2020","11/07/2020","12/07/2020","13/07/2020",
          "14/07/2020","15/07/2020", "16/07/2020", "17/07/2020", "18/07/2020", "19/07/2020", "20/07/2020",
          "21/07/2020", "22/07/2020", "23/07/2020", "24/07/2020",
          "25/07/2020","26/07/2020", "27/07/2020", "28/07/2020", "29/07/2020", "30/07/2020", "31/07/2020", "1/08/2020", "2/08/2020", "3/08/2020",
          "4/08/2020", "5/08/2020", "6/08/2020", "7/08/2020", "8/8/2020", "9/8/2020", "10/08/2020", "11/08/2020", "12/08/2020",
          "13/08/2020", "14/08/2020", "15/08/2020",
          "16/08/2020", "17/08/2020", "18/08/2020", "19/08/2020", "20/08/2020",
          "21/08/2020", "22/08/2020", "23/08/2020", "24/08/2020",
          "25/08/2020", "26/08/2020", "27/08/2020", "28/08/2020",
          "29/08/2020","30/08/2020", "31/08/2020", "1/09/2020",
          "2/09/2020","3/09/2020", "4/09/2020","5/09/2020",
          "6/09/2020","7/09/2020", "8/09/2020", "9/09/2020",
          "10/09/2020", "11/09/2020", "12/09/2020","13/09/2020",
          "14/09/2020","15/09/2020", "16/09/2020", "17/09/2020",
          "18/09/2020", "19/09/2020", "20/09/2020", "21/09/2020",
          "22/09/2020", "23/09/2020", "24/09/2020", "25/09/2020",
          "26/09/2020", "27/09/2020", "28/09/2020", "29/09/2020", "30/09/2020","1/10/2020",
          "2/10/2020","3/10/2020", "4/10/2020","5/10/2020",
          "6/10/2020","7/10/2020", "8/10/2020", "9/10/2020",
          "10/10/2020", "11/10/2020", "12/10/2020","13/10/2020",
          "14/10/2020","15/10/2020", "16/10/2020", "17/10/2020",
          "18/10/2020", "19/10/2020", "20/10/2020", "21/10/2020",
          "22/10/2020", "23/10/2020", "24/10/2020", "25/10/2020",
          "26/10/2020", "27/10/2020", "28/10/2020", "29/10/2020", "30/10/2020",
          "31/10/2020", "1/11/2020",
          "2/11/2020","3/11/2020", "4/11/2020","5/11/2020",
          "6/11/2020","7/11/2020", "8/11/2020", "9/11/2020",
          "10/11/2020", "11/11/2020", "12/11/2020","13/11/2020",
          "14/11/2020","15/11/2020", "16/11/2020", "17/11/2020",
          "18/11/2020", "19/11/2020", 
          "20/11/2020", "21/11/2020", "22/11/2020","23/11/2020",
          "24/11/2020","25/11/2020", "26/11/2020", "27/11/2020",
          "28/11/2020", "29/11/2020" )

Dia <- as.Date(Dia, "%d/%m")

Activos <- c( 450, 451, 458, 482, 502, 543, 551, 578, 604, 649,
            708, 680, 698, 698, 661, 738, 774, 822, 835, 885, 913,912,
            969, 1077, 1103, 1142, 1192, 1208, 1310, 1371, 1495,
            1480, 1574, 1617, 1600, 1755, 1825, 1941, 1761, 1794,
            1788, 1765, 1833, 1904, 1845, 1900, 1604,
            1588, 1532, 1577, 1623, 1621, 1675, 1803, 1866, 1737,
            1822, 1927, 2098, 2226, 2322, 2259, 2209,
            2272, 2325, 2434, 2433,2536, 2483, 2345, 2341, 2247,
            2281, 2400, 2478, 2446, 2384, 2363, 2412, 2466, 2449,
            2506, 2470, 2383, 2395, 2451, 2497, 2402, 2442, 2399,
            2359, 2455, 2521, 2654, 2732, 2734,
            2694, 2617, 2636, 2715, 2760, 2729,
            2792, 2755, 2667, 2676, 2744, 2741,2829, 2814,2759, 2719, 2735, 2844,
            2784, 2707, 2725, 2698, 2616, 2607, 2706,
            2692, 2684, 2691, 2638, 2572, 2584, 2584,
            2564, 2558, 2597, 2572, 2559, 2571, 2595,
            2600, 2619, 2619, 2635, 2611, 2551, 2570,
            2583, 2562, 2549, 2550, 2505, 2475, 2459,
            2469, 2457, 2458, 2456
            )

Recuperados <- c( 288, 335, 367, 385, 400, 425, 468, 485, 505, 536,
                549, 633, 675, 707, 819, 819, 845, 923, 960, 960, 1039,
                1109, 1162, 1207, 1257, 1327, 1389, 1451, 1538, 1593,
                1719, 1814, 1887, 1966, 2054, 2187, 2288, 2423,
                2827, 2969, 3099, 3259,3435, 3582, 3809, 3985, 4444, 4606, 4761, 4875, 5001, 5193, 5324, 5435, 5435, 5652, 5792, 5909, 6080,6207, 6377, 6557, 6695, 6889, 7055, 7256, 7419,
                7604, 7824, 8030, 8247, 8562, 8739, 8906, 9095,
                9263, 9444, 9658, 9813, 10066, 10252, 10422, 
                10611, 10780, 10975, 11105, 11273, 11469,
                11638, 11763, 11929, 12082, 12210, 12318, 12451,
                12589, 12742, 12877, 13009, 13145, 13285, 13422,
                13576, 13701, 13832, 13975, 14103, 14254, 14402,
                14562, 14699, 14817, 14950, 15040, 15180, 15308,
                15437, 15548, 15661, 15769, 15843, 15957, 16079,
                16150, 16248, 16339, 16414, 16486, 16586, 16673,
                16746, 16812, 16885, 16944, 16995, 17075, 17137,
                17137, 17194, 17259, 17331, 17382, 17448, 17538,
                17608, 17659, 17727, 17774, 17815, 17839, 17911,
                17949, 17982)

Fallecidas <- c( 21, 22, 23, 23, 23, 23, 23, 24, 29, 29,
                32, 32, 33, 33, 33, 34, 34, 35, 36, 38, 38,
                41, 41, 41, 42, 46, 47, 47, 48, 48, 52, 53, 53, 55,
                56, 57, 59, 60, 68, 68, 69, 69, 70, 74, 74, 78, 80, 85, 90, 96,
                99, 104, 107, 118, 121, 123, 127, 128, 158, 179,183,183, 188, 194, 201, 204, 212, 219, 224, 227, 232, 236, 249, 255, 259,
                263, 265, 266, 277, 282, 286, 290, 293, 296,
                307, 315, 326, 471, 475, 475, 475, 475, 475,
                475, 475, 475, 475, 519, 527, 535,
                538, 541, 549, 557, 568, 570, 574,
                576, 589, 595, 595, 601, 606, 609,
                620, 630, 634, 634, 639, 651, 654,
                657, 659, 665, 667, 670, 673, 677,
                687, 691, 692, 693, 698, 701, 705,
                709, 709, 709, 714, 718, 723, 730,
                733, 733, 735, 735, 737, 738, 743,
                744, 746, 751, 753)

EnEstudio <- c( 839, 853, 922, 975, 918, 819, 923, 866, 924, 917,
              836, 865, 801, 865, 800, 790, 814, 877, 814, 820, 728,
              753, 798, 806, 986, 912, 919, 953, 959, 1164, 1215,
              1234, 1230, 1152, 1399, 1470, 1401, 1393, 1426, 1334, 1387, 1565, 1514, 1599, 1613, 1569, 1441, 1347, 1346, 1343, 1459, 1471, 1399, 1196,
              1264, 1445, 1480, 1448, 1390, 1364, 1337, 1240,
              1527, 1562, 1485, 1417, 1563, 1361, 1226, 1570, 
              1782, 1797, 1784, 1666, 1493, 1435, 1798, 1686,
              1793, 1619, 1593, 1471, 1414, 1541, 1543, 1495,
              1495, 1353, 1160, 1183, 1159, 1127, 1351, 1288,
              1237, 1149, 1120, 1236, 1264, 1159, 1187, 1177,
              1125, 1079, 1022, 1075, 1160, 1151, 1114, 1028,
              1026, 1086, 1139, 1096, 1067, 1096, 1046, 1080,
              1073, 1056, 1103, 1094, 1094, 1046, 1061, 1070,
              1056, 1048, 1055, 1094, 1057, 1032, 1065, 1057,
              1037, 1105, 1049, 994, 965, 1015, 1082, 1060,
              1024, 987, 986, 988, 1038, 1015, 1112, 1062,
              999, 946, 970)

Descartados <- c( 4881, 4992, 5089, 5189, 5300, 5467, 5479, 5583, 5716, 5841,
                 6076, 6190, 6302, 6364, 6584, 6758, 6882, 7056, 7194, 7383,
                 7558, 7660, 7766, 8706, 9551, 9654, 9715, 9792, 10015, 
                 10185, 10238, 10424, 10620, 10705, 10738, 10944, 11115,
                 11274, 11468, 11694, 11774, 11835, 12060, 12265,
                 12469, 12711, 12992, 13173, 13251, 13403, 13592,13820,
                 14059, 14319, 14413, 14488, 14665, 14916, 15105,
                 15392, 15613, 15761, 15811, 16010, 16235,
                 16400, 16665, 16884, 17053, 17701, 17302,
                 17577, 17849, 18086, 18313, 18549, 18666,
                 18882, 19177, 19402, 19611, 19823, 19933,
                 20002, 20279, 20531, 20742, 20951, 21159,
                 21255, 21358, 21481, 21690, 21875, 22156,
                 22281, 22507, 22613, 22765, 22927, 23071,
                 23194, 23353, 23483, 23541, 23650, 23863,
                 24021, 24358, 24546, 24678, 24698, 24863,
                 25125, 25285, 25399, 25567, 25681, 25968,
                 26157, 26376, 26598, 26712, 26954, 27071,
                 27141, 27345, 27604, 27834, 28128, 28424, 28499,
                 28589, 28715, 28874, 29046, 29164, 29278,
                 29362, 29422, 29541, 29687, 29827, 29963,
                 30097, 30165, 30205, 30260, 30389, 30527,
                 30702, 30840, 30904)

TotalesC <- c( 759, 808, 848, 890, 925, 991, 1042, 1087, 1138, 1214,
              1289, 1345, 1406, 1438, 1513, 1591, 1653, 1780, 1831, 1831,
              1990, 2062, 2172, 2325, 2402, 2515, 2628, 2706, 2896,
              3012, 3230, 3347, 3514, 3638, 3710, 3999, 4172, 4424,
              4656, 4831, 4956, 5093, 5338, 5560, 5728, 5963, 6128, 6279, 6383, 6548, 6723, 6918, 7106, 7356, 7422, 7512, 7741, 7964, 8336,8612, 8882, 8999, 9092, 9355, 9581, 9894, 10064,
              10359, 10531, 10602, 10820, 11045, 11269, 11561,
              11832, 11972, 12093, 12287, 12502, 12814, 12987,
              13218, 13374, 13459, 13677, 13871, 14096, 14342,
              14555, 14637, 14763, 15012, 15206, 15447, 15658,
              15798, 15911, 16013, 16172, 16395, 16583, 16692,
              16917, 17013, 17067, 17221, 17421, 17571, 17820,
              17971, 18053, 18137, 18291, 18493, 18584, 18645,
              18796, 18880, 18916, 19027, 19203, 19306, 19422,
              19506, 19553, 19581, 19671, 19747, 19837, 19922,
              20035, 20077, 20142, 20216, 20295, 20383, 20465,
              20465, 20543, 20588, 20605, 20688, 20764, 20833,
              20892, 20944, 20969, 20987, 21017, 21052, 21114,
              21158, 21191)

CovLP <- data.frame(Dia, Activos, Recuperados, Fallecidas, EnEstudio, Descartados, TotalesC)

CovLP <- CovLP %>% mutate( pFallecidos = Fallecidas/TotalesC*100,
                          pActivos = Activos/TotalesC*100,
                        pRecuperados = Recuperados/TotalesC*100,
                        pEnEstudio = EnEstudio/TotalesC*100)
```


```{r Preparación para gráfica}
CovLPR <- gather(CovLP, Indicador , IValor, 2:11)
options(digits = 3)
```


```{r Gráfica en porcentajes}
CovLPR %>% filter( Indicador %in% c("pFallecidos",
                                    "pActivos",
                                    "pRecuperados")) %>%
ggplot(aes(Dia, IValor, group = Indicador, col = Indicador))+
geom_line(size = 1.5)+
geom_point(size = 3.5)+
labs(title =  "Coronavirus - La Plata en % ",
     subtitle = "",
     caption = "Fuente: Elaboración propia con datos de la Municipalidad de La Plata",
     y = "%")+
   annotate(geom="text", x=as.Date("2020-11-29"), y=88, 
             label="85%")+
   annotate(geom="text", x=as.Date("2020-11-29"), y=14, 
             label="11.5%")+
   annotate(geom="text", x=as.Date("2020-11-29"), y=5, 
             label="3.5%")+
   annotate(geom="text", x=as.Date("2020-11-05"), y=86, 
             label="83.6%")+
   annotate(geom="text", x=as.Date("2020-11-05"), y=16, 
             label="13%")+
   annotate(geom="text", x=as.Date("2020-11-05"), y=5, 
             label="3.5%")+
   annotate(geom="text", x=as.Date("2020-10-05"), y=82, 
             label="80.4%")+
   annotate(geom="text", x=as.Date("2020-10-05"), y=19, 
             label="16.3%")+
   annotate(geom="text", x=as.Date("2020-10-05"), y=5, 
             label="3.2%")+
   annotate(geom="text", x=as.Date("2020-09-05"), y=77, 
             label="73.4%")+
   annotate(geom="text", x=as.Date("2020-09-05"), y=27, 
             label="24.5%")+
   annotate(geom="text", x=as.Date("2020-09-05"), y=5, 
             label="2.1%")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=24, 
             label="25.3%")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=76, 
             label="73.4%")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=4, 
             label="1.3%")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=42, 
             label="44.2%")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=58, 
             label="54.2%")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=4, 
             label="1.6%")+
   annotate(geom="text", x=as.Date("2020-07-15"), y=56, 
             label="46.4%")+
   annotate(geom="text", x=as.Date("2020-07-15"), y=43, 
             label="51.5%")+
   annotate(geom="text", x=as.Date("2020-07-15"), y=4, 
             label="2.1%")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=61, 
             label="59.3%")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=36, 
             label="37.9%")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=5, 
             label="2.7%")+
      scale_color_viridis(discrete = TRUE)+
xlab(" ")+
ylab(" ")+
    scale_x_date(date_breaks = "15 day", date_minor_breaks = "1 day",
             date_labels = "%d/%m")+
   scale_y_continuous(breaks = c(0,10,20,30,40,50,60,70,80,90))+
   scale_color_tableau()+
   theme_excel_new(base_size = 15)
```



```{r Gráfica cantidades}
CovLPR %>% filter( Indicador %in% c("Fallecidas",
                                    "Recuperados",
                                    "Activos",
                                    "TotalesC")) %>%
ggplot(aes(Dia, IValor, group = Indicador, col = Indicador))+
geom_line(size = 1.4)+
geom_point(size = 3)+
 labs(title =  "Covid-19 Cantidad Casos 21191 - La Plata ",
      subtitle = "5/08 nueva modalidad de conteo casos",
    caption = "Fuente: Elaboración propia con datos de la Municipalidad de La Plata")+
   ylim(0,22000)+
    annotate(geom="text", x=as.Date("2020-11-19"), y=21150, 
             label="20764")+
    annotate(geom="text", x=as.Date("2020-11-19"), y=870, 
             label="733")+
   annotate(geom="text", x=as.Date("2020-11-19"), y=17900, 
             label="17448")+
   annotate(geom="text", x=as.Date("2020-11-19"), y=2900, 
             label="2583")+
       annotate(geom="text", x=as.Date("2020-09-17"), y=13200, 
             label="12814")+
    annotate(geom="text", x=as.Date("2020-09-17"), y=450, 
             label="282")+
   annotate(geom="text", x=as.Date("2020-09-17"), y=10500, 
             label="10066")+
   annotate(geom="text", x=as.Date("2020-09-17"), y=2800, 
             label="2466")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=550, 
             label="450")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=1850, 
             label="1588")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=370, 
             label="288")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=5000, 
             label="4606")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=130, 
             label="21")+
    annotate(geom="text", x=as.Date("2020-08-16"), y=250, 
             label="85")+
   annotate(geom="text", x=as.Date("2020-06-30"), y=840, 
             label="759")+
   annotate(geom="text", x=as.Date("2020-08-16"), y=6700, 
             label="6279")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=190, 
             label="53")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=2100, 
             label="1814")+
   annotate(geom="text", x=as.Date("2020-07-31"), y=1350, 
             label="1480")+
      annotate(geom="text", x=as.Date("2020-07-31"), y=3600, 
             label="3347")+
 xlab(" ")+
 ylab(" ")+
   scale_color_tableau()+
   theme_excel_new(base_size = 15)+
   scale_x_date(date_breaks = "15 day", date_minor_breaks = "15 day",
             date_labels = "%d/%m")+
   scale_y_continuous(breaks = c(0, 4000,8000,12000,
                                 16000,20000,22000))




```


####Gráfica interactiva

```{r Gráfica interactiva}
CovLPR %>% filter( Indicador %in% c("pFallecidos", "pActivos","pRecuperados"))%>%
   plot_ly(x = ~ Dia, y = ~IValor, type = "scatter",
           mode = "marker",
           color = ~ Indicador) %>%
   layout(title = "Coronavirus La Plata - en % ",
          xaxis = list (title = ".",
                        yaxis = list(title = ".")))

```

```{r Gráfica interactiva II}
CovLPR %>% filter( Indicador %in% c("Fallecidas", "Activos","Recuperados", "TotalesC"))%>%
   plot_ly(x = ~ Dia, y = ~IValor, type = "scatter",
           mode = "marker",
           color = ~ Indicador) %>%
   layout(title = "Coronavirus La Plata - Cantidad Casos ",
          xaxis = list (title = ".",
                        yaxis = list(title = ".")))
```

